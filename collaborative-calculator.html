<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Chatroom - Modal Realism Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4682B4 0%, #5F9EA0 50%, #2F4F4F 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 2em;
            font-weight: 300;
        }

        .nav-link {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-content {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
        }

        .chat-container {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .user-count {
            background: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            color: #495057;
        }

        .chat-messages {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px 15px 30px 15px;
            margin-bottom: 15px;
            overflow-y: auto;
            max-height: calc(100vh - 300px);
            min-height: 400px;
            border: 1px solid #e9ecef;
        }

        .chat-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 15px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .chat-message.own {
            background: #667eea;
            color: white;
            margin-left: auto;
        }

        .chat-message.other {
            background: white;
            color: #2c3e50;
            border: 1px solid #e9ecef;
        }

        .chat-message.private {
            background: #e8f5e8;
            color: #2c3e50;
            border: 2px solid #28a745;
            border-left: 5px solid #28a745;
        }

        .chat-message.private.own {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
            border-right: 5px solid #28a745;
        }

        .chat-message.system {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            text-align: center;
            margin: 10px auto;
            max-width: 90%;
            font-size: 0.9em;
        }

        .chat-message .user {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 4px;
        }

        .chat-message .time {
            font-size: 0.8em;
            opacity: 0.7;
            margin-top: 4px;
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: #667eea;
        }

        .send-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .send-btn:hover {
            background: #5a6fd8;
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: calc(100vh - 120px);
        }

        .sidebar h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .user-info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .user-info h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .user-info input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
        }

        .user-info input:focus {
            outline: none;
            border-color: #667eea;
        }

        .online-users {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .online-users h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .user-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .user-tag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .user-tag.own {
            background: #28a745;
        }

        .private-message-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .private-message-section h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .private-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .private-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .private-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .private-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .chat-info {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .chat-info h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .chat-info p {
            color: #6c757d;
            font-size: 0.9em;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .quick-actions {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .quick-actions h4 {
            color: #495057;
            margin-bottom: 10px;
        }

        .quick-btn {
            width: 100%;
            background: #e9ecef;
            color: #495057;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin: 5px 0;
            transition: background 0.3s;
        }

        .quick-btn:hover {
            background: #dee2e6;
        }

        .message-count {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: -1;
                max-height: 300px;
            }

            .chat-messages {
                max-height: calc(100vh - 400px);
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí¨ Free Chatroom</h1>
            <a href="index.html" class="nav-link">‚Üê Back to Main</a>
        </div>

        <div class="main-content">
            <div class="chat-container">
                <div class="chat-header">
                    <h3>Community Chat</h3>
                    <div class="user-count" id="userCount">1 user online</div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message system">
                        <div>Welcome to the free chatroom! Say whatever you want - no censorship!</div>
                        <div class="time">Just now</div>
                    </div>
                </div>

                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." onkeypress="handleChatKeyPress(event)">
                    <button class="send-btn" onclick="sendChatMessage()">Send</button>
                </div>
            </div>

            <div class="sidebar">
                <div class="user-info">
                    <h4>Your Username <span style="color: #dc3545;">*</span></h4>
                    <input type="text" id="usernameInput" placeholder="Enter username (required)" value="">
                </div>

                <div class="online-users">
                    <h4>Online Users</h4>
                    <div class="user-list" id="userList">
                        <span style="color: #6c757d; font-style: italic;">No users online</span>
                    </div>
                </div>

                <div class="private-message-section">
                    <h4>Private Message</h4>
                    <select id="privateRecipient" class="private-select">
                        <option value="">Select user to message</option>
                    </select>
                    <input type="text" id="privateMessageInput" class="private-input" placeholder="Type private message..." onkeypress="handlePrivateKeyPress(event)">
                    <button class="quick-btn" onclick="sendPrivateMessage()">Send Private</button>
                </div>

                <div class="chat-info">
                    <h4>About This Chat</h4>
                    <p>This is a free chatroom where you can say anything you want. No words are censored or filtered.</p>
                    <p>Chat with other users about anything - philosophy, modal realism, or just random topics!</p>
                    <p>Messages are stored locally in your browser.</p>
                </div>

                <div class="quick-actions">
                    <h4>Quick Actions</h4>
                    <button class="quick-btn" onclick="sendQuickMessage('Hello everyone! üëã')">Say Hello</button>
                    <button class="quick-btn" onclick="sendQuickMessage('What are you all thinking about?')">Ask Question</button>
                    <button class="quick-btn" onclick="sendQuickMessage('Anyone want to discuss modal realism?')">Modal Realism</button>
                    <button class="quick-btn" onclick="sendQuickMessage('Random thought: ' + getRandomThought())">Random Thought</button>
                    <button class="quick-btn" onclick="exportChat()">Export Chat</button>
                </div>

                <div class="message-count" id="messageCount">
                    Messages: 1
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = '';
        let messageCount = 1;
        let users = new Set();

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved messages
            loadSavedMessages();
            loadPrivateMessages();
            
            // Set initial username (empty by default)
            currentUser = '';
            
            // Update username when changed
            document.getElementById('usernameInput').addEventListener('input', function() {
                const username = this.value.trim();
                if (username && !users.has(username)) {
                    // Remove old user from list if it was different
                    if (currentUser && currentUser !== 'Anonymous') {
                        users.delete(currentUser);
                    }
                    currentUser = username;
                    users.add(username);
                    updateUserList();
                }
            });

            // Add welcome message
            addSystemMessage('Please enter a username to start chatting!');
        });

        // Send chat message
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            const usernameInput = document.getElementById('usernameInput');
            const username = usernameInput.value.trim();
            
            if (!message) return;
            
            // Check if username is provided
            if (!username) {
                alert('Please enter a username before sending a message.');
                usernameInput.focus();
                return;
            }
            
            // Check if username is already taken
            if (users.has(username) && username !== currentUser) {
                alert('This username is already taken. Please choose a different name.');
                usernameInput.focus();
                return;
            }
            
            // Update current user if changed
            if (currentUser !== username) {
                // Remove old user from list if it was different
                if (currentUser && currentUser !== 'Anonymous') {
                    users.delete(currentUser);
                }
                currentUser = username;
                users.add(username);
                updateUserList();
            }
            
            addChatMessage(currentUser, message, true);
            input.value = '';
            
            // Save to localStorage
            saveMessage(currentUser, message);
        }

        // Send quick message
        function sendQuickMessage(message) {
            const usernameInput = document.getElementById('usernameInput');
            const username = usernameInput.value.trim();
            
            // Check if username is provided
            if (!username) {
                alert('Please enter a username before sending a message.');
                usernameInput.focus();
                return;
            }
            
            // Check if username is already taken
            if (users.has(username) && username !== currentUser) {
                alert('This username is already taken. Please choose a different name.');
                usernameInput.focus();
                return;
            }
            
            // Update current user if changed
            if (currentUser !== username) {
                // Remove old user from list if it was different
                if (currentUser && currentUser !== 'Anonymous') {
                    users.delete(currentUser);
                }
                currentUser = username;
                users.add(username);
                updateUserList();
            }
            
            addChatMessage(currentUser, message, true);
            saveMessage(currentUser, message);
        }

        // Handle chat key press
        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        // Add chat message
        function addChatMessage(user, message, isOwn = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${isOwn ? 'own' : 'other'}`;
            
            messageDiv.innerHTML = `
                <div class="user">${user}</div>
                <div>${message}</div>
                <div class="time">${new Date().toLocaleTimeString()}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Update message count
            messageCount++;
            document.getElementById('messageCount').textContent = `Messages: ${messageCount}`;
            
            // Add user to list if not already there
            if (!users.has(user)) {
                users.add(user);
                updateUserList();
            }
        }

        // Add system message
        function addSystemMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message system';
            
            messageDiv.innerHTML = `
                <div>${message}</div>
                <div class="time">${new Date().toLocaleTimeString()}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Update user list
        function updateUserList() {
            const userList = document.getElementById('userList');
            const privateRecipient = document.getElementById('privateRecipient');
            
            userList.innerHTML = '';
            privateRecipient.innerHTML = '<option value="">Select user to message</option>';
            
            if (users.size === 0) {
                userList.innerHTML = '<span style="color: #6c757d; font-style: italic;">No users online</span>';
            } else {
                users.forEach(user => {
                    // Add to user list display
                    const userTag = document.createElement('span');
                    userTag.className = `user-tag ${user === currentUser ? 'own' : ''}`;
                    userTag.textContent = user;
                    userTag.onclick = () => selectUserForPrivate(user);
                    userList.appendChild(userTag);
                    
                    // Add to private message dropdown (exclude current user)
                    if (user !== currentUser) {
                        const option = document.createElement('option');
                        option.value = user;
                        option.textContent = user;
                        privateRecipient.appendChild(option);
                    }
                });
            }
            
            document.getElementById('userCount').textContent = `${users.size} user${users.size !== 1 ? 's' : ''} online`;
        }

        // Select user for private message
        function selectUserForPrivate(username) {
            const privateRecipient = document.getElementById('privateRecipient');
            privateRecipient.value = username;
        }

        // Send private message
        function sendPrivateMessage() {
            const recipient = document.getElementById('privateRecipient').value;
            const message = document.getElementById('privateMessageInput').value.trim();
            
            if (!recipient) {
                alert('Please select a user to message.');
                return;
            }
            
            if (!message) {
                alert('Please enter a message.');
                return;
            }
            
            if (!currentUser) {
                alert('Please enter your username first.');
                document.getElementById('usernameInput').focus();
                return;
            }
            
            // Add private message to chat
            addPrivateMessage(currentUser, recipient, message);
            
            // Clear input
            document.getElementById('privateMessageInput').value = '';
            
            // Save to localStorage
            savePrivateMessage(currentUser, recipient, message);
        }

        // Handle private message key press
        function handlePrivateKeyPress(event) {
            if (event.key === 'Enter') {
                sendPrivateMessage();
            }
        }

        // Add private message to chat
        function addPrivateMessage(sender, recipient, message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message private ${sender === currentUser ? 'own' : 'other'}`;
            
            const isOwn = sender === currentUser;
            const displayText = isOwn ? `Private to ${recipient}: ${message}` : `Private from ${sender}: ${message}`;
            
            messageDiv.innerHTML = `
                <div class="user">${sender} ‚Üí ${recipient}</div>
                <div>${message}</div>
                <div class="time">${new Date().toLocaleTimeString()}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Update message count
            messageCount++;
            document.getElementById('messageCount').textContent = `Messages: ${messageCount}`;
        }

        // Save private message to localStorage
        function savePrivateMessage(sender, recipient, message) {
            const messages = JSON.parse(localStorage.getItem('privateMessages') || '[]');
            messages.push({
                sender: sender,
                recipient: recipient,
                message: message,
                timestamp: new Date().toISOString(),
                time: new Date().toLocaleTimeString()
            });
            
            // Keep only last 100 private messages
            if (messages.length > 100) {
                messages.splice(0, messages.length - 100);
            }
            
            localStorage.setItem('privateMessages', JSON.stringify(messages));
        }

        // Load saved private messages
        function loadPrivateMessages() {
            const messages = JSON.parse(localStorage.getItem('privateMessages') || '[]');
            
            messages.forEach(msg => {
                addPrivateMessage(msg.sender, msg.recipient, msg.message);
            });
        }


        // Export chat
        function exportChat() {
            const messages = document.querySelectorAll('.chat-message:not(.system)');
            let chatText = 'Chat Export - ' + new Date().toLocaleString() + '\n\n';
            
            messages.forEach(msg => {
                const user = msg.querySelector('.user').textContent;
                const message = msg.querySelector('div:not(.user):not(.time)').textContent;
                const time = msg.querySelector('.time').textContent;
                const isPrivate = msg.classList.contains('private');
                const prefix = isPrivate ? '[PRIVATE]' : '[PUBLIC]';
                chatText += `[${time}] ${prefix} ${user}: ${message}\n`;
            });
            
            const blob = new Blob([chatText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chat-export-' + new Date().toISOString().split('T')[0] + '.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Get random thought
        function getRandomThought() {
            const thoughts = [
                'What if gravity worked backwards?',
                'Is there a world where I\'m a professional philosopher?',
                'What would happen if time moved in reverse?',
                'Are there infinite possible worlds?',
                'What if mathematics was completely different?',
                'Is consciousness necessary for existence?',
                'What if causality didn\'t exist?',
                'Are we living in the best possible world?',
                'What if the universe was made of pure thought?',
                'Is there a world where 2+2=5?'
            ];
            return thoughts[Math.floor(Math.random() * thoughts.length)];
        }

        // Save message to localStorage
        function saveMessage(user, message) {
            const messages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
            messages.push({
                user: user,
                message: message,
                timestamp: new Date().toISOString(),
                time: new Date().toLocaleTimeString()
            });
            
            // Keep only last 100 messages
            if (messages.length > 100) {
                messages.splice(0, messages.length - 100);
            }
            
            localStorage.setItem('chatMessages', JSON.stringify(messages));
        }

        // Load saved messages
        function loadSavedMessages() {
            const messages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
            
            messages.forEach(msg => {
                addChatMessage(msg.user, msg.message, false);
                if (!users.has(msg.user)) {
                    users.add(msg.user);
                }
            });
            
            updateUserList();
        }

        // Simulate other users (for demo purposes)
        function simulateOtherUsers() {
            const otherUsers = ['Alice', 'Bob', 'Charlie', 'Diana', 'Eve', 'Frank', 'Grace'];
            const randomMessages = [
                'Hey everyone! How\'s it going?',
                'Anyone want to discuss philosophy?',
                'What do you think about modal realism?',
                'This is a cool chatroom!',
                'I love talking about possible worlds',
                'Anyone here interested in mathematics?',
                'What\'s your favorite philosophical concept?',
                'This is so much better than social media',
                'I can say whatever I want here!',
                'Anyone want to debate something?'
            ];
            
            // Occasionally add a random message
            if (Math.random() < 0.3) {
                const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
                const randomMessage = randomMessages[Math.floor(Math.random() * randomMessages.length)];
                
                if (!users.has(randomUser)) {
                    users.add(randomUser);
                    updateUserList();
                }
                
                addChatMessage(randomUser, randomMessage, false);
            }
        }

        // Simulate other users every 30-60 seconds
        setInterval(simulateOtherUsers, Math.random() * 30000 + 30000);
    </script>
</body>
</html>