<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proposition Calculator - Modal Realism & Classical Logic</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .nav-link {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .auth-header {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .auth-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .auth-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .user-info {
            color: white;
            font-size: 14px;
            margin-right: 10px;
        }

        .auth-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .auth-modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .close:hover {
            color: #000;
        }

        .auth-form {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .auth-tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .auth-tab-content {
            display: none;
        }

        .auth-tab-content.active {
            display: block;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .input-group {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .input-group label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }

        .input-group input, .input-group textarea {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            min-width: 200px;
            flex: 1;
        }

        .input-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #555;
        }

        .result-value {
            color: #2c3e50;
            font-family: 'Courier New', monospace;
        }

        .logical-formula {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
        }

        .modal-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .existential {
            background: #d4edda;
            color: #155724;
        }

        .universal {
            background: #cce5ff;
            color: #004085;
        }

        .temporal {
            background: #fff3cd;
            color: #856404;
        }

        .world-visualization {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .world-bar {
            height: 20px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .world-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .philosophy-note {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 20px;
            border-radius: 15px;
            margin-top: 30px;
            border-left: 5px solid #e17055;
        }

        .philosophy-note h4 {
            color: #2d3436;
            margin-bottom: 10px;
        }

        .philosophy-note p {
            color: #636e72;
            line-height: 1.6;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #dc3545;
        }

        .examples-section {
            background: #e8f4f8;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #17a2b8;
        }

        .example-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .example-item:hover {
            background: #f8f9fa;
        }

        .example-english {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .example-logic {
            font-family: 'Courier New', monospace;
            color: #6c757d;
            font-size: 0.9em;
        }

        .analysis-breakdown {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .analysis-step {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .input-group input, .input-group textarea {
                min-width: auto;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="auth-header" id="authHeader">
                <div class="user-info" id="userInfo" style="display: none;">
                    <span>Welcome, <span id="userName"></span>!</span>
                </div>
                <button class="auth-btn" id="loginBtn" onclick="showAuthModal()">Login</button>
                <button class="auth-btn" id="registerBtn" onclick="showAuthModal('register')">Register</button>
                <button class="auth-btn" id="profileBtn" onclick="openProfile()" style="display: none;">Profile</button>
                <button class="auth-btn" id="logoutBtn" onclick="logout()" style="display: none;">Logout</button>
            </div>
            
            <a href="index.html" class="nav-link">← Back to Main</a>
            
            <h1>Proposition Calculator</h1>
            <p>Classical Logic Translation & Modal Realism Analysis</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('translate')">Proposition Translation</button>
                <button class="tab" onclick="switchTab('analyze')">Modal Analysis</button>
                <button class="tab" onclick="switchTab('examples')">Examples</button>
            </div>

            <!-- Translation Tab -->
            <div id="translate" class="tab-content active">
                <div class="input-section">
                    <div class="input-group">
                        <label for="sentenceInput">Enter Proposition:</label>
                        <textarea id="sentenceInput" placeholder="Enter an English sentence to translate to classical logic..." rows="3">It might rain tomorrow.</textarea>
                        <button class="btn" onclick="translateProposition()">Translate to Logic</button>
                    </div>
                </div>
            </div>

            <!-- Modal Analysis Tab -->
            <div id="analyze" class="tab-content">
                <div class="input-section">
                    <div class="input-group">
                        <label for="analyzeInput">Analyze Proposition:</label>
                        <textarea id="analyzeInput" placeholder="Enter a proposition for modal realism analysis..." rows="3">All possible worlds contain some form of consciousness.</textarea>
                        <button class="btn btn-success" onclick="analyzeModal()">Analyze Modal Structure</button>
                    </div>
                </div>
            </div>

            <!-- Examples Tab -->
            <div id="examples" class="tab-content">
                <div class="examples-section">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">Example Propositions</h3>
                    <p style="color: #6c757d; margin-bottom: 20px;">Click on any example to see its logical translation and modal analysis.</p>
                    
                    <div class="example-item" onclick="loadExample('It might rain tomorrow.')">
                        <div class="example-english">It might rain tomorrow.</div>
                        <div class="example-logic">∃w (Rain(t_+1, w))</div>
                    </div>
                    
                    <div class="example-item" onclick="loadExample('If it rains tomorrow, the ground will be wet the next day.')">
                        <div class="example-english">If it rains tomorrow, the ground will be wet the next day.</div>
                        <div class="example-logic">(Rain(t_+1, w0) → Wet_ground(t_+2, w0))</div>
                    </div>
                    
                    <div class="example-item" onclick="loadExample('Yesterday it did not rain.')">
                        <div class="example-english">Yesterday it did not rain.</div>
                        <div class="example-logic">¬Rain(t_-1, w0)</div>
                    </div>
                    
                    <div class="example-item" onclick="loadExample('All dogs may bark tomorrow.')">
                        <div class="example-english">All dogs may bark tomorrow.</div>
                        <div class="example-logic">∃w (∀x (Dog(x) → Bark(x, t_+1, w)))</div>
                    </div>
                    
                    <div class="example-item" onclick="loadExample('John eats now and Mary sleeps.')">
                        <div class="example-english">John eats now and Mary sleeps.</div>
                        <div class="example-logic">Eats(John, t_0, w0) ∧ Sleeps(Mary, t_0, w0)</div>
                    </div>
                    
                    <div class="example-item" onclick="loadExample('Necessarily, all possible worlds exist.')">
                        <div class="example-english">Necessarily, all possible worlds exist.</div>
                        <div class="example-logic">∀w (Exists(w))</div>
                    </div>
                    
                    <div class="example-item" onclick="loadExample('Some possible worlds might contain unicorns.')">
                        <div class="example-english">Some possible worlds might contain unicorns.</div>
                        <div class="example-logic">∃w (∃x (Unicorn(x, w)))</div>
                    </div>
                </div>
            </div>

            <div id="results"></div>

            <div class="philosophy-note">
                <h4>Philosophical Foundation</h4>
                <p>
                    This proposition calculator implements classical logic translation within Takashi Yagisawa's extended modal realism framework. 
                    Propositions are analyzed as they relate to possible worlds, with temporal indexing (t_-1, t_0, t_+1) and world quantification (∃w, ∀w).
                    <br><br>
                    <strong>Key Features:</strong>
                    • <strong>Modal Operators:</strong> ∃w (existential) and ∀w (universal) world quantification
                    • <strong>Temporal Indexing:</strong> Past (t_-1), Present (t_0), Future (t_+1) time references
                    • <strong>Classical Logic:</strong> Proper translation of English to first-order predicate logic
                    • <strong>World Analysis:</strong> Mapping propositions to their modal structure and possible world implications
                </p>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal">
        <div class="auth-modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <h2>Authentication</h2>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
                <div class="auth-tab" onclick="switchAuthTab('register')">Register</div>
            </div>
            
            <div id="loginTab" class="auth-tab-content active">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="modalLoginEmail">Email:</label>
                        <input type="email" id="modalLoginEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="modalLoginPassword">Password:</label>
                        <input type="password" id="modalLoginPassword" placeholder="Enter your password">
                    </div>
                    <button class="btn" onclick="modalLogin()">Login</button>
                </div>
            </div>
            
            <div id="registerTab" class="auth-tab-content">
                <div class="auth-form">
                    <div class="form-group">
                        <label for="modalRegisterName">Full Name:</label>
                        <input type="text" id="modalRegisterName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="modalRegisterEmail">Email:</label>
                        <input type="email" id="modalRegisterEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="modalRegisterPassword">Password:</label>
                        <input type="password" id="modalRegisterPassword" placeholder="Enter your password">
                    </div>
                    <div class="form-group">
                        <label for="modalConfirmPassword">Confirm Password:</label>
                        <input type="password" id="modalConfirmPassword" placeholder="Confirm your password">
                    </div>
                    <button class="btn" onclick="modalRegister()">Register</button>
                </div>
            </div>
            
            <div id="authMessage"></div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        // Modal and temporal detection
        const MODAL_EXISTENTIAL = new Set(["might", "may", "could", "possible", "possibly"]);
        const MODAL_UNIVERSAL = new Set(["must", "necessarily", "will"]);
        const QUANTIFIERS_ALL = new Set(["all", "every", "each"]);
        const QUANTIFIERS_EXIST = new Set(["some", "a", "an", "there", "exists", "exist"]);
        const TEMPORAL_PAST = new Set(["yesterday", "ago", "last", "did", "was", "were"]);
        const TEMPORAL_FUTURE = new Set(["tomorrow", "next", "soon", "will"]);

        // Simple tokenizer and basic parsing
        function tokenize(text) {
            return text.toLowerCase().replace(/[.,!?;]/g, '').split(/\s+/);
        }

        function detectTimeIndex(tokens) {
            for (let token of tokens) {
                if (TEMPORAL_PAST.has(token) || token.endsWith('ed')) {
                    return "t_-1";
                }
                if (TEMPORAL_FUTURE.has(token) || token === 'will') {
                    return "t_+1";
                }
            }
            return "t_0";
        }

        function detectModality(tokens) {
            for (let token of tokens) {
                if (MODAL_EXISTENTIAL.has(token)) {
                    return ("exists", "∃w");
                }
                if (MODAL_UNIVERSAL.has(token)) {
                    return ("forall", "∀w");
                }
            }
            return null;
        }

        function detectQuantifier(tokens) {
            for (let token of tokens) {
                if (QUANTIFIERS_ALL.has(token)) {
                    return "forall";
                }
                if (QUANTIFIERS_EXIST.has(token)) {
                    return "exists";
                }
            }
            return null;
        }

        function isConditional(tokens) {
            return tokens.includes('if') || tokens.includes('then');
        }

        function isConjunction(tokens) {
            return tokens.includes('and') || tokens.includes('or');
        }

        function extractSubjectVerbObject(tokens) {
            // Simplified extraction - in a real implementation, you'd use proper NLP
            let subject = null;
            let verb = null;
            let object = null;
            
            // Find common patterns
            for (let i = 0; i < tokens.length; i++) {
                if (tokens[i] === 'it' || tokens[i] === 'this' || tokens[i] === 'that') {
                    subject = tokens[i];
                }
                if (tokens[i] === 'rain' || tokens[i] === 'rains') {
                    verb = 'Rain';
                }
                if (tokens[i] === 'ground') {
                    object = 'ground';
                }
                if (tokens[i] === 'dogs') {
                    subject = 'dogs';
                }
                if (tokens[i] === 'bark' || tokens[i] === 'barks') {
                    verb = 'Bark';
                }
                if (tokens[i] === 'john') {
                    subject = 'John';
                }
                if (tokens[i] === 'eats' || tokens[i] === 'eat') {
                    verb = 'Eats';
                }
                if (tokens[i] === 'mary') {
                    subject = 'Mary';
                }
                if (tokens[i] === 'sleeps' || tokens[i] === 'sleep') {
                    verb = 'Sleeps';
                }
            }
            
            return { subject, verb, object };
        }

        function buildPredicate(subject, verb, object, timeIndex, worldIndex = "w0") {
            if (!verb) {
                // Fallback for complex sentences
                return `Proposition(${timeIndex}, ${worldIndex})`;
            }
            
            let args = [];
            if (subject) args.push(subject);
            if (object) args.push(object);
            
            const argStr = args.length > 0 ? args.join(', ') : '';
            return `${verb}(${argStr}, ${timeIndex}, ${worldIndex})`;
        }

        function translateProposition() {
            const input = document.getElementById('sentenceInput');
            const sentence = input.value.trim();
            
            if (!sentence) {
                showError('Please enter a proposition to translate.');
                return;
            }

            const tokens = tokenize(sentence);
            const timeIndex = detectTimeIndex(tokens);
            const modality = detectModality(tokens);
            const quantifier = detectQuantifier(tokens);
            
            let formula = '';
            let worldWrap = '';
            
            if (modality) {
                const [type, symbol] = modality;
                worldWrap = symbol;
            }
            
            if (isConditional(tokens)) {
                // Handle conditionals
                const ifIndex = tokens.indexOf('if');
                const thenIndex = tokens.indexOf('then');
                
                let antecedent, consequent;
                if (thenIndex > ifIndex) {
                    antecedent = tokens.slice(ifIndex + 1, thenIndex).join(' ');
                    consequent = tokens.slice(thenIndex + 1).join(' ');
                } else {
                    // Split by comma or heuristic
                    const commaIndex = tokens.indexOf(',');
                    if (commaIndex > ifIndex) {
                        antecedent = tokens.slice(ifIndex + 1, commaIndex).join(' ');
                        consequent = tokens.slice(commaIndex + 1).join(' ');
                    } else {
                        antecedent = tokens.slice(ifIndex + 1, ifIndex + 4).join(' ');
                        consequent = tokens.slice(ifIndex + 4).join(' ');
                    }
                }
                
                const antTokens = tokenize(antecedent);
                const consTokens = tokenize(consequent);
                
                const antSVO = extractSubjectVerbObject(antTokens);
                const consSVO = extractSubjectVerbObject(consTokens);
                
                const antFormula = buildPredicate(antSVO.subject, antSVO.verb, antSVO.object, timeIndex);
                const consFormula = buildPredicate(consSVO.subject, consSVO.verb, consSVO.object, timeIndex);
                
                formula = `(${antFormula} → ${consFormula})`;
            } else if (isConjunction(tokens)) {
                // Handle conjunctions/disjunctions
                const andIndex = tokens.indexOf('and');
                const orIndex = tokens.indexOf('or');
                
                if (andIndex > -1) {
                    const part1 = tokens.slice(0, andIndex).join(' ');
                    const part2 = tokens.slice(andIndex + 1).join(' ');
                    
                    const svo1 = extractSubjectVerbObject(tokenize(part1));
                    const svo2 = extractSubjectVerbObject(tokenize(part2));
                    
                    const formula1 = buildPredicate(svo1.subject, svo1.verb, svo1.object, timeIndex);
                    const formula2 = buildPredicate(svo2.subject, svo2.verb, svo2.object, timeIndex);
                    
                    formula = `(${formula1} ∧ ${formula2})`;
                } else if (orIndex > -1) {
                    const part1 = tokens.slice(0, orIndex).join(' ');
                    const part2 = tokens.slice(orIndex + 1).join(' ');
                    
                    const svo1 = extractSubjectVerbObject(tokenize(part1));
                    const svo2 = extractSubjectVerbObject(tokenize(part2));
                    
                    const formula1 = buildPredicate(svo1.subject, svo1.verb, svo1.object, timeIndex);
                    const formula2 = buildPredicate(svo2.subject, svo2.verb, svo2.object, timeIndex);
                    
                    formula = `(${formula1} ∨ ${formula2})`;
                }
            } else {
                // Simple sentence
                const svo = extractSubjectVerbObject(tokens);
                formula = buildPredicate(svo.subject, svo.verb, svo.object, timeIndex);
            }
            
            // Add negation if present
            if (tokens.includes('not') || tokens.includes('didn\'t') || tokens.includes('doesn\'t')) {
                formula = `¬${formula}`;
            }
            
            // Add quantifiers
            if (quantifier === 'forall') {
                formula = `∀x (${formula.replace(/dogs/g, 'x').replace(/Dog\(x\)/g, 'Dog(x)')})`;
            } else if (quantifier === 'exists') {
                formula = `∃x (${formula.replace(/some/g, 'x')})`;
            }
            
            // Wrap with world quantifier
            if (worldWrap) {
                formula = `${worldWrap} (${formula})`;
            }
            
            displayTranslationResults(sentence, formula, {
                timeIndex,
                modality,
                quantifier,
                tokens
            });
        }

        function analyzeModal() {
            const input = document.getElementById('analyzeInput');
            const sentence = input.value.trim();
            
            if (!sentence) {
                showError('Please enter a proposition to analyze.');
                return;
            }

            const tokens = tokenize(sentence);
            const timeIndex = detectTimeIndex(tokens);
            const modality = detectModality(tokens);
            const quantifier = detectQuantifier(tokens);
            
            // Analyze modal structure
            const modalStructure = analyzeModalStructure(sentence, tokens, timeIndex, modality, quantifier);
            
            displayModalAnalysis(sentence, modalStructure);
        }

        function analyzeModalStructure(sentence, tokens, timeIndex, modality, quantifier) {
            const structure = {
                original: sentence,
                timeIndex,
                modality,
                quantifier,
                worldScope: null,
                temporalScope: null,
                logicalComplexity: 'simple',
                modalStrength: 'none',
                worldImplications: []
            };
            
            // Determine world scope
            if (modality) {
                structure.worldScope = modality[0];
                structure.modalStrength = modality[0];
            }
            
            // Determine temporal scope
            if (timeIndex === 't_-1') {
                structure.temporalScope = 'past';
            } else if (timeIndex === 't_+1') {
                structure.temporalScope = 'future';
            } else {
                structure.temporalScope = 'present';
            }
            
            // Determine logical complexity
            if (isConditional(tokens)) {
                structure.logicalComplexity = 'conditional';
            } else if (isConjunction(tokens)) {
                structure.logicalComplexity = 'conjunctive';
            } else if (tokens.includes('not')) {
                structure.logicalComplexity = 'negated';
            }
            
            // Generate world implications
            if (modality && modality[0] === 'exists') {
                structure.worldImplications.push('True in at least one possible world');
                structure.worldImplications.push('Contingent proposition');
            } else if (modality && modality[0] === 'forall') {
                structure.worldImplications.push('True in all possible worlds');
                structure.worldImplications.push('Necessary proposition');
            } else {
                structure.worldImplications.push('True in actual world only');
                structure.worldImplications.push('Factual proposition');
            }
            
            return structure;
        }

        function displayTranslationResults(sentence, formula, analysis) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Logical Translation</h3>
                        <div class="logical-formula">${formula}</div>
                        <div class="result-item">
                            <span class="result-label">Original:</span>
                            <span class="result-value">"${sentence}"</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Time Index:</span>
                            <span class="result-value">${analysis.timeIndex}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Modality:</span>
                            <span class="result-value">
                                ${analysis.modality ? analysis.modality[0] : 'None'}
                                ${analysis.modality ? `<span class="modal-indicator ${analysis.modality[0]}">${analysis.modality[1]}</span>` : ''}
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Quantifier:</span>
                            <span class="result-value">${analysis.quantifier || 'None'}</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>Analysis Breakdown</h3>
                        <div class="analysis-breakdown">
                            <div class="analysis-step">
                                <strong>Temporal Analysis:</strong> ${analysis.timeIndex === 't_-1' ? 'Past tense' : analysis.timeIndex === 't_+1' ? 'Future tense' : 'Present tense'}
                            </div>
                            <div class="analysis-step">
                                <strong>Modal Analysis:</strong> ${analysis.modality ? `${analysis.modality[0]} world quantification` : 'No modal operators'}
                            </div>
                            <div class="analysis-step">
                                <strong>Quantification:</strong> ${analysis.quantifier ? `${analysis.quantifier} quantification detected` : 'No explicit quantification'}
                            </div>
                            <div class="analysis-step">
                                <strong>Logical Structure:</strong> ${isConditional(analysis.tokens) ? 'Conditional' : isConjunction(analysis.tokens) ? 'Conjunctive' : 'Simple proposition'}
                            </div>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>Symbol Legend</h3>
                        <div class="result-item">
                            <span class="result-label">∃w:</span>
                            <span class="result-value">There exists a possible world</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">∀w:</span>
                            <span class="result-value">For all possible worlds</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">t_-1:</span>
                            <span class="result-value">Past time</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">t_0:</span>
                            <span class="result-value">Present time</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">t_+1:</span>
                            <span class="result-value">Future time</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">→:</span>
                            <span class="result-value">Implication (if-then)</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">∧:</span>
                            <span class="result-value">Conjunction (and)</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">∨:</span>
                            <span class="result-value">Disjunction (or)</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">¬:</span>
                            <span class="result-value">Negation (not)</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayModalAnalysis(sentence, structure) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Modal Structure Analysis</h3>
                        <div class="result-item">
                            <span class="result-label">Proposition:</span>
                            <span class="result-value">"${sentence}"</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">World Scope:</span>
                            <span class="result-value">
                                ${structure.worldScope || 'Actual world only'}
                                ${structure.worldScope ? `<span class="modal-indicator ${structure.worldScope}">${structure.worldScope === 'exists' ? '∃w' : '∀w'}</span>` : ''}
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Temporal Scope:</span>
                            <span class="result-value">
                                ${structure.temporalScope}
                                <span class="modal-indicator temporal">${structure.timeIndex}</span>
                            </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Logical Complexity:</span>
                            <span class="result-value">${structure.logicalComplexity}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Modal Strength:</span>
                            <span class="result-value">${structure.modalStrength}</span>
                        </div>
                    </div>

                    <div class="result-card">
                        <h3>World Implications</h3>
                        ${structure.worldImplications.map(implication => `
                            <div class="analysis-step">
                                <strong>•</strong> ${implication}
                            </div>
                        `).join('')}
                    </div>

                    <div class="result-card">
                        <h3>Modal Realism Interpretation</h3>
                        <div class="world-visualization">
                            <p><strong>Possible World Analysis:</strong></p>
                            <div class="world-bar" style="width: ${structure.worldScope === 'forall' ? '100' : structure.worldScope === 'exists' ? '60' : '30'}%"></div>
                            <p><small>
                                ${structure.worldScope === 'forall' ? 'True in all possible worlds (necessary)' : 
                                  structure.worldScope === 'exists' ? 'True in some possible worlds (contingent)' : 
                                  'True in actual world only (factual)'}
                            </small></p>
                            <p><strong>Modal Dimension:</strong> ${structure.worldScope ? 'Cross-world proposition' : 'Actual world proposition'}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadExample(example) {
            document.getElementById('sentenceInput').value = example;
            translateProposition();
        }

        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function showError(message) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        // Initialize with default translation
        function openProfile() {
            window.open('profile.html', '_blank');
        }

        window.onload = function() {
            translateProposition();
        };
    </script>
</body>
</html>
